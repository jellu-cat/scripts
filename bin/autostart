#!/bin/sh

############################################################

# Script Name     :   Autostart
# Description     :   WM-agnostic script for setting up
#                     the environment
# Args            :   none
# Author          :   Jellu Cat

############################################################

#############
# Functions #
#############

wm=$(wmctrl -m | awk 'NR == 1 {print $2}')

# Runs a program only if it isn't running
run (){
    local name=$1

    if (pidof "$name" > /dev/null); then
        echo "$name already running!"
    else
        echo "Running $name"
       `$name` &
    fi
}

# Runs a program killing any other instances, useful to restart after
# changing the configuration files
initialize (){
    local name=$1

    if (pidof "$name" > /dev/null); then
        killall "$name"
        echo "$name killed"
    fi

    `$name` &
    echo "Running $name"
}

start_keybindings(){
    killall sxhkd
    sxhkd -c ~/.config/sxhkd/sxhkdrc &

    if [ $wm = "bspwm" ]; then
        sxhkd -c ~/.config/sxhkd/bsphkd &
    fi
}

# Wallpaper
~/.fehbg &

# Running some essential programs
run compton
initialize redshift
start_keybindings
initialize copyq
initialize nm-applet

# bar-related
initialize polybar
initialize stalonetray &
toggle-window stalonetray
